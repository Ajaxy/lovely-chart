!function(){function t(t,e,n){const o=t,a=e,i=n;function c(t,e,n,a=1){const c=2*Math.pow(n,2),s=Math.floor(t.yMin/c)*c,r=Math.ceil(t.yMax/c)*c;o.textAlign="left",o.textBaseline="bottom",o.fillStyle=B(t,"axesText",a),o.strokeStyle=B(t,"yAxisRulers",a),o.lineWidth=.5,o.beginPath();for(let t=s;t<=r;t+=c){const{yPx:n}=e.toPixels(0,t);o.fillText(I(t),d,n-d/2),o.moveTo(d,n),o.lineTo(i.width-d,n)}o.stroke()}return{update:function(t,e){o.font=f,function(t,e){const n=i.height-x/2,c=Math.floor(t.xAxisScale),s=Math.pow(2,c),r=1-(t.xAxisScale-c);o.textAlign="center",o.textBaseline="middle";for(let c=Math.floor(t.labelFromIndex)-h;c<=t.labelToIndex+h;c++){if((c-p)%s!=0)continue;const l=a.xLabels[c];if(!l)continue;const{xPx:u}=e.toPixels(c,0);let h=(c-p)%(2*s)==0?1:r;const f=Math.min(u+d,i.width-u);1===h&&f<=4*d&&(h=Math.min(1,f/(4*d))),o.fillStyle=B(t,"axesText",h),o.fillText(l.text,u,n)}}(t,e),function(t,e){const n=t.yAxisScale;if(n%1==0)c(t,e,n);else{const o=Math.floor(n);c(t,e,o,1-(n-o));const a=Math.ceil(n);c(t,e,a,1-(a-n))}}(t,e)}}}function e(t,e,i,c,s){const{begin:r,end:l}=i,d=t.xLabels.length-1,u=Math.max(0,Math.ceil(d*r)),h=Math.min(d,Math.floor(d*l)),[f,m]=n(d,r,l,s,u,h),x=t.datasets.filter(({key:t})=>c[t]).map(({values:t})=>t),p=x.map(t=>t.slice(f,m+1)),{max:y=s.yMaxFiltered}=F(O(x)),v=0,{max:M=s.yMax}=F(O(p)),b=0,L={};return t.datasets.forEach(({key:t})=>{L[`opacity#${t}`]=c[t]?1:0}),{xOffset:r*d,xWidth:(l-r)*d,yMinFiltered:0,yMaxFiltered:y,yMin:0,yMax:M,xAxisScale:o(t.xLabels.length,e.width,r,l),yAxisScale:a(e.height,0,M),labelFromIndex:u,labelToIndex:h,...L,...R(),...i,filter:c}}function n(t,e,n,o,a,i){const c=n-e,s=Math.max(-.35,Math.min((e-o.begin)*P,.35)),r=Math.max(-.35,Math.min((n-o.end)*P,.35)),l=Math.max(0,Math.min(e+s,1-c)),d=Math.max(c,Math.min(n+r,1)),u=Math.abs(s)>.1?Math.max(0,Math.ceil(t*l)):a,h=Math.abs(r)>.1?Math.max(0,Math.ceil(t*d)):i;return[u,h]}function o(t,e,n,o){const a=t*(o-n)/Math.floor(e/m);return Math.ceil(Math.log2(a))}function a(t,e,n){const o=t-x,a=(n-e)/Math.floor(o/g);return Math.ceil(Math.sqrt(a/2))}function i(t,{width:e,height:n}){const o=document.createElement("canvas");o.width=e*L,o.height=n*L,o.style.width="100%",o.style.height=`${n}px`;const a=o.getContext("2d");return a.scale(L,L),t.appendChild(o),{canvas:o,context:a}}function c(t,e){e.clearRect(0,0,t.width,t.height)}window.LovelyChart={create:function(n,o){const a=function(t){const{datasets:e}=function(t){const{columns:e,names:n,colors:o}=t;let a=[];const i=[];return e.forEach(t=>{const e=t.shift();e!==s?i.push({key:e,color:o[e],name:n[e],values:t}):function(t){for(let e=0,n=t.length;e<n;e++)if(void 0!==t[e]&&void 0!==t[e+1]&&t[e]>=t[e+1])throw new Error("Array is not sorted")}(a=t)}),i.forEach(t=>{t.labels=a}),{datasets:i}}(t);let n=1/0,o=-1/0;e.forEach(t=>{const{max:e}=F(t.values);0<n&&(n=0),e>o&&(o=e),t.yMin=0,t.yMax=e});const a=e.map(t=>t.labels[0]),i=e.map(t=>t.labels[t.labels.length-1]),c=Math.min.apply(null,a),r=Math.max.apply(null,i),l=function(t,e){t=X(t),e=X(e);const n=[];for(let o=t;o<=e;o+=E){const t=new Date(o),e=t.getDate(),a=w[t.getMonth()];n.push({value:o,text:`${a} ${e}`})}return n}(c,r);return{datasets:e,yMin:n,yMax:o,xLabels:l}}(o);let f,m,g,p,L,T,P;function j(){return{width:m.offsetWidth,height:m.offsetHeight}}function R(t){const e=W(t,function(){const{width:t,height:e}=j();return{width:t,height:e-x}}(),{xPadding:d});c(m,g),p.update(t,e),function(t,e){const n={from:t.labelFromIndex-h,to:t.labelToIndex+h};a.datasets.forEach(({key:o,color:a,values:i})=>{const c={color:a,opacity:t[`opacity#${o}`],lineWidth:u};S(g,i,e,c,n)})}(t,e),T.update(t),P.update(t,e)}function H(t){L.update({range:t})}function q(t){L.update({filter:t})}return function(t){(f=document.createElement("div")).className="lovely-chart",document.getElementById(t).appendChild(f)}(n),function(){const{canvas:t,context:e}=i(f,{width:f.clientWidth,height:f.clientWidth*l});m=t,g=e}(),p=t(g,a,j()),L=function(t,n,o){const a=t,i=n,c=o,s={begin:0,end:1},r=function(){const t={};return a.datasets.forEach(({key:e})=>{t[e]=!0}),t}(),l=O([A,a.datasets.map(({key:t})=>`opacity#${t}`)]),d=function(t){const e=t,n={};let o=null;function a(t){delete n[t],i()||(cancelAnimationFrame(o),o=null)}function i(){return Boolean(Object.keys(n).length)}function c(){const t={};Object.keys(n).forEach(e=>{const{startedAt:o,from:i,to:c}=n[e],s=Math.min(1,(Date.now()-o)/C),r=i+(c-i)*function(t){return Math.sin(Math.PI/2*t)}(s);n[e].current=r,t[e]=r,1===s&&a(e)}),e(t),i()&&(o=requestAnimationFrame(c))}return{add:function(t,e,a){n[t]={from:e,to:a,current:e,startedAt:Date.now()},o||(o=requestAnimationFrame(c))},remove:a,get:function(t){return n[t]},getState:function(){const t={};return Object.keys(n).forEach(e=>{t[e]=n[e].current}),t},isRunning:i}}(f),u=D(f);let h={};function f(){c({...h,...d.getState()})}return{update:function({range:t={},filter:n={}}={}){Object.assign(s,t),Object.assign(r,n);const o=h;h=e(a,i,s,r,o),l.forEach(t=>{const e=d.get(t),n=e?e.to:o[t];if(void 0!==n&&n!==h[t]){const n=e?e.current:o[t];e&&d.remove(t),d.add(t,n,h[t])}}),d.isRunning()||u()}}}(a,j(),R),T=function(t,e,n){const o=t,a=e,s=n;let l,d,u,h,f,m,g,x={},p=null;const L=D(function(){const{begin:t,end:e}=x;h.children[0].style.width=`${100*t}%`,h.children[1].style.width=`${100*(e-t)}%`,h.children[2].style.width=`${100*(1-e)}%`});function E(t){m=t.target.offsetLeft}function w(t,e,{dragOffsetX:n}){const o=d.offsetWidth,a=o-f.offsetWidth,i=Math.max(0,Math.min(m+n,a)),c=i+f.offsetWidth,s=i/o,r=c/o;C({begin:s,end:r})}function $(t,e,{dragOffsetX:n}){const o=d.offsetWidth,a=f.offsetLeft+f.offsetWidth-2*M,i=Math.min(a,Math.max(0,m+n)),c=i/o;C({begin:c})}function k(t,e,{dragOffsetX:n}){const o=d.offsetWidth,a=f.offsetLeft+2*M,i=o,c=Math.max(a,Math.min(m+M+n,i)),s=c/o;C({end:s})}function C(t){const e=Object.assign({},x,t);e.begin===x.begin&&e.end===x.end||(x=e,L(),s(x),p&&(clearTimeout(p),p=null),p=setTimeout(()=>{s(x)},50))}return(l=document.createElement("div")).className="minimap",l.style.height=`${y}px`,function(){const{canvas:t,context:e}=i(l,{width:o.offsetWidth-2*v,height:y});d=t,u=e}(),(h=document.createElement("div")).className="ruler",h.innerHTML=b,N(f=h.children[1],{onCapture:E,onDrag:w,draggingCursor:"grabbing"}),N(f.children[0],{onCapture:E,onDrag:$,draggingCursor:"ew-resize"}),N(f.children[1],{onCapture:E,onDrag:k,draggingCursor:"ew-resize"}),l.appendChild(h),o.appendChild(l),C(r),{update:function(t){(function(t){if(!g)return!0;const e=a.datasets.map(({key:t})=>`opacity#${t}`);return e.push("yMaxFiltered"),e.some(e=>g[e]!==t[e])})(t)&&(g=t,c(d,u),function(t={}){const e={width:d.offsetWidth,height:d.offsetHeight};a.datasets.forEach(({key:n,color:o,values:i})=>{const c=t[`opacity#${n}`],s=2===a.datasets.length&&function(t,e){if(t.filter){const n=t[`opacity#${e}`],o=Object.values(t.filter).filter(t=>!0===t).length,a=t.filter[e],i=a?o>1:o>0;return n<1&&i}return!1}(t,n),r={xOffset:0,xWidth:a.xLabels.length,yMin:s?a.yMin:t.yMinFiltered,yMax:s?a.yMax:t.yMaxFiltered},l=W(r,e),d={color:o,opacity:c,lineWidth:1};S(u,i,l,d)})}(t))}}}(f,a,H),P=function(t,e,n){const o=t,a=e,s=n;let r,l,d,u,h,f,m;const g=D(v);function p(t){m="touchmove"===t.type?t.touches[0].pageX-function(t){let e=t.offsetLeft;for(;t=t.parentNode&&t.offsetLeft;)e+=t.offsetLeft;return e}(t.touches[0].target):t.offsetX,g()}function y(t){t&&t.preventDefault(),m=null,c(u,h),f.classList.remove("shown")}function v(){if(!m||!r)return;const t=m,e=r,{findClosesLabelIndex:n,toPixels:o}=l,i=n(t);if(i<0||i>=a.xLabels.length)return;c(u,h);const{xPx:d}=o(i,0);!function(t,e,n){h.strokeStyle=n,h.lineWidth=1,h.beginPath(),h.moveTo(t,0),h.lineTo(t,e),h.stroke()}(d,s.height-x,B(e,"tooltipTail"));const g=a.datasets.filter(({key:t})=>e.filter[t]).map(({name:t,color:e,values:n})=>({name:t,color:e,value:n[i]}));g.forEach(({value:t,color:n})=>{!function({xPx:t,yPx:e},n,o){h.strokeStyle=n,h.fillStyle=o,h.lineWidth=2,h.beginPath(),h.arc(t,e,4,0,2*Math.PI),h.fill(),h.stroke()}(o(i,t),n,B(e,"bg"))}),function(t,e,n){const o=a.xLabels[n],i=new Date(o.value);f.children[0].innerHTML=`${$[i.getDay()]}, ${o.text}`,f.children[1].innerHTML=t.map(({name:t,color:e,value:n})=>`<div class="dataset" style="color: ${e}"><div>${I(n,2)}</div><div>${t}</div></div>`).join("");const c=Math.max(k,Math.min(e,s.width-f.offsetWidth+k));f.style.left=`${c}px`,f.classList.add("shown")}(g,d,i)}return(d=document.createElement("div")).className="tooltip",function(){const{canvas:t,context:e}=i(d,s);u=t,h=e}(),(f=document.createElement("div")).className="balloon",f.innerHTML='<div class="title"></div><div class="legend"></div>',d.appendChild(f),d.addEventListener("mousemove",p),d.addEventListener("touchmove",p),d.addEventListener("mouseout",y),d.addEventListener("mouseup",y),d.addEventListener("touchend",y),d.addEventListener("touchcancel",y),o.appendChild(d),{update:function(t,e){r=t,l=e,v()}}}(f,a,j()),function(t,e,n){const o=t,a=e,i=n;let c;function s(t){t&&(t.preventDefault(),t.currentTarget.classList.toggle("checked"));const e={};Array.from(c.getElementsByTagName("a")).forEach(t=>{e[t.dataset.key]=t.classList.contains("checked")}),i(e)}(c=document.createElement("div")).className="tools",a.datasets.forEach(({key:t,name:e,color:n})=>{const o=document.createElement("a");o.href="#",o.dataset.key=t,o.className="checkbox checked",o.innerHTML=`<span class="circle"></span><span class="label">${e}</span>`,o.firstChild.style.borderColor=n,o.addEventListener("click",s),c.appendChild(o)}),o.appendChild(c),s()}(f,a,q),{redraw:function(){L.update()}}}};const s="x",r={begin:.333,end:.667},l=.9,d=10,u=2,h=10,f="300 10px Helvetica, Arial, sans-serif",m=45,g=50,x=30,p=1,y=40,v=10,M=5,b='<div class="mask"></div><div class="slider"><div></div><div></div></div><div class="mask"></div>',L=window.devicePixelRatio||1,E=864e5,w=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],$=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],k=20,C=300,T={day:{bg:[255,255,255],axesText:[150,162,170],yAxisRulers:[242,244,245],tooltipTail:[223,230,235]},night:{bg:[36,47,62],axesText:[84,103,120],yAxisRulers:[41,53,68],tooltipTail:[59,74,90]}},A=["yMax","xAxisScale","yAxisScale","yMaxFiltered",...O(Object.keys(T.day).map(t=>["R","G","B"].map(e=>`colorChannels#${t}#${e}`)))],P=15;function W(t,e,{xPadding:n=0}={}){let o=e.width;0===t.begin&&(o-=n),1===t.end&&(o-=n);const a=o/t.xWidth;let i=t.xOffset*a;0===t.begin&&(i-=n);const c=e.height/t.yMax,s=t.yMin*c;return{toPixels:(t,n)=>({xPx:t*a-i,yPx:e.height-(n*c-s)}),findClosesLabelIndex:t=>Math.round((t+i)/a)}}function S(t,e,n,o,a){const{from:i=0,to:c=e.length}=a||{};t.save(),t.strokeStyle=o.color,t.lineWidth=o.lineWidth,t.globalAlpha=o.opacity,t.beginPath();for(let o=i;o<=c;o++){const{xPx:a,yPx:i}=n.toPixels(o,e[o]);0===o?t.moveTo(a,i):t.lineTo(a,i)}t.stroke(),t.restore()}function F(t){const e=t.length;let n=t[0],o=t[0];for(let a=0;a<e;a++){const e=t[a];e>n?n=e:e<o&&(o=e)}return{max:n,min:o}}function O(t){return[].concat.apply([],t)}function D(t){let e=!1;return function(){e||(e=!0,requestAnimationFrame(()=>{e=!1,t()}))}}function X(t){return t-t%E}function I(t,e=1){return t>=1e6?j(t/1e6,e)+"M":t>=1e3?j(t/1e3,e)+"K":t}function j(t,e){return t.toFixed(e).replace(/(\d{3,})\.\d+/,"$1").replace(/\.0+$/,"")}function N(t,e){let n=null;function o(o){o.target===t&&(o.preventDefault(),n=o,"mousedown"===o.type?(document.addEventListener("mousemove",i),document.addEventListener("mouseup",a)):"touchstart"===o.type&&(document.addEventListener("touchmove",i),document.addEventListener("touchend",a),document.addEventListener("touchcancel",a),void 0===o.pageX&&(o.pageX=o.touches[0].pageX)),e.draggingCursor&&document.body.classList.add(`cursor-${e.draggingCursor}`),e.onCapture&&e.onCapture(o))}function a(){n&&(e.draggingCursor&&document.body.classList.remove(`cursor-${e.draggingCursor}`),document.removeEventListener("mouseup",a),document.removeEventListener("mousemove",i),document.removeEventListener("touchcancel",a),document.removeEventListener("touchend",a),document.removeEventListener("touchmove",i),n=null)}function i(t){n&&("touchmove"===t.type&&void 0===t.pageX&&(t.pageX=t.touches[0].pageX),e.onDrag(t,n,{dragOffsetX:t.pageX-n.pageX}))}t.addEventListener("mousedown",o),t.addEventListener("touchstart",o)}function R(){const t={};return Object.keys(T.day).forEach(e=>{["R","G","B"].forEach((n,o)=>{t[`colorChannels#${e}#${n}`]=T[document.body.classList.contains("skin-night")?"night":"day"][e][o]})}),t}function B(t,e,n=1){return function([t,e,n],o=1){return`rgba(${t}, ${e}, ${n}, ${o})`}(function(t,e){return["R","G","B"].map(n=>Math.round(t[`colorChannels#${e}#${n}`]))}(t,e),n)}}();
