(function(){var ue=Math.PI,ge=Math.abs,me=Math.round,fe=Math.pow,xe=Math.min,ve=Math.floor,be=Math.max,Me=Math.ceil;function e(e,a,i){function n({range:l={},filter:d={},focusOn:i,minimapDelta:n}={},y){Object.assign(s,l),Object.assign(o,d);const u=p;p=t(e,a,s,o,i,n,u),y||r.forEach(({prop:e,duration:t,options:a})=>{const i=c.get(e),n=i?i.to:u[e];if(n!==void 0&&n!==p[e]){const n=i?a.includes("fast")?u[e]:i.current:u[e];i&&c.remove(e),c.add(e,n,p[e],t,a)}}),c.isRunning()||h()}function l(){i(ce(p,c.getState()))}const s={begin:0,end:1},o=function(){const t={};return e.datasets.forEach(({key:e})=>{t[e]=!0}),t}(),r=function(){const t=[],a=e.datasets.map(({key:e})=>`opacity#${e} 300`);return de([Ge,a]).forEach(e=>{const[a,i,...n]=e.split(" ");t.push({prop:a,duration:i,options:n})}),t}(),c=d(l),h=pe(l);let p={};return{update:n}}function t(e,t,i,o,d,r,c){const{begin:h,end:p}=i,y=e.xLabels.length-1,u=be(0,Me(y*h)),g=xe(ve(y*p),y),m=l(t.width,u,g),f=e.isStacked?n(e,o,u,g,c):a(e,o,u,g,c),x=s(t.height,f.yMinViewport,f.yMaxViewport),v=e.hasSecondYAxis&&s(t.height,f.yMinViewportSecond,f.yMaxViewportSecond),b=U(x);if(f.yMinViewport-=f.yMinViewport%b,v){const e=U(v);f.yMinViewportSecond-=f.yMinViewportSecond%e}const M={};return e.datasets.forEach(({key:e})=>{M[`opacity#${e}`]=o[e]?1:0}),Object.assign({totalXWidth:y,xAxisScale:m,yAxisScale:x,yAxisScaleSecond:v,labelFromIndex:be(0,u-1),labelToIndex:xe(g+1,y),filter:Object.assign({},o),focusOn:void 0===d?c.focusOn:d,minimapDelta:void 0===r?c.minimapDelta:r},f,M,i)}function a(e,t,a,n,l){const s=e.hasSecondYAxis&&e.datasets.slice(-1)[0],o=e.datasets.filter(e=>t[e.key]&&e!==s),d=i(e,a,n,l,o);if(s){const o=t[s.key]?[s]:[],{yMinViewport:r,yMaxViewport:c,yMinMinimap:h,yMaxMinimap:p}=i(e,a,n,l,[s]);Object.assign(d,{yMinViewportSecond:r,yMaxViewportSecond:c,yMinMinimapSecond:h,yMaxMinimapSecond:p})}return d}function i(e,t,a,i,n){const{min:l=i.yMinMinimap,max:s=i.yMaxMinimap}=oe(de(n.map(({yMax:e,yMin:t})=>[e,t]))),o=l/s>ze?l:0;let d,r;if(0===t&&a===e.xLabels.length-1)d=o,r=s;else{const e=n.map(({values:e})=>e),l=e.map(e=>e.slice(t,a+1)),s=oe(de(l)),o=s.min===void 0?i.yMinViewport:s.min;r=s.max===void 0?i.yMaxViewport:s.max,d=o/r>ze?o:0}return{yMinViewport:d,yMaxViewport:r,yMinMinimap:o,yMaxMinimap:s}}function n(e,t,a,i,n){const l=e.datasets.filter(e=>t[e.key]),s=l.map(({values:e})=>e),o=s.length?re(s):[],{max:d=n.yMaxMinimap}=oe(o),{max:r=n.yMaxViewport}=oe(o.slice(a,i+1));return{yMinViewport:0,yMaxViewport:r,yMinMinimap:0,yMaxMinimap:d}}function l(e,t,a){const i=ve(e/Fe);return Z((a-t)/i)}function s(e,t,a){const i=ve((e-Xe)/De);return J((a-t)/i)}function o(e){return 1-fe(1-e,1.675)}function d(e){function t(e,t,a,i,o){l[e]={from:t,to:a,duration:i,options:o,current:t,startedAt:Date.now(),progress:0},s||(s=requestAnimationFrame(n))}function a(e){delete l[e],i()||(cancelAnimationFrame(s),s=null)}function i(){return!!Object.keys(l).length}function n(){const t={};Object.keys(l).forEach(e=>{const{startedAt:i,from:n,to:s,duration:r=we,options:d}=l[e],c=xe(1,(Date.now()-i)/r);let h=n+(s-n)*o(c);d.includes("ceil")?h=Me(h):d.includes("floor")&&(h=ve(h)),l[e].current=h,l[e].progress=c,t[e]=h,1===c&&a(e)}),e(t),i()&&(s=requestAnimationFrame(n))}const l={};let s=null;return{add:t,remove:a,get:function(e){return l[e]},getState:function(){const e={};return Object.keys(l).forEach(t=>{const{current:a,from:i,to:n,progress:s}=l[t];e[t]=a,e[`${t}From`]=i,e[`${t}To`]=n,e[`${t}Progress`]=s}),e},isRunning:i}}function r(e,t,a){function i(e){c.innerHTML?c.innerHTML!==e&&(c=ne(c,e,"lovely-chart--header-caption lovely-chart--position-right")):(c.innerHTML=e,p=!1)}function n(e){h=!0,r=ne(d,"Zoom Out","lovely-chart--header-title lovely-chart--header-zoom-out-control"),ae(r,"click",s),i(e)}function l(){o=nt(),o.className="lovely-chart--header",d=nt(),d.className="lovely-chart--header-title",d.innerHTML=t,o.appendChild(d),c=nt(),c.className="lovely-chart--header-caption lovely-chart--position-right",o.appendChild(c),e.appendChild(o)}function s(){h=!0,d=ne(r,t,"lovely-chart--header-title",!0),a()}let o,d,r,c,h=!1,p=!0;const y=he(i,400,!1,!0);return l(),{setCaption:y,zoom:n}}function c(e,t,a,n){function l(t,i,l,s,o,d=1,r=null,c=!1){const h=U(l),p=Me(s/h)*h,y=ve(o/h)*h;e.font=He,e.textAlign=c?"right":"left",e.textBaseline="bottom",e.lineWidth=1,e.beginPath();for(let u=p;u<=y;u+=h){const[,t]=i.toPixels(0,u),l=_(d,t);e.fillStyle=r?O(n,`${r}-text`,l):O(n,"y-axis-text",l),c?e.fillText(Y(u),a.width-Ve,t-5):e.fillText(Y(u),Ve,t-5),c?(e.strokeStyle=O(n,`${r}-text`,d),e.moveTo(a.width-Ve,t),e.lineTo(a.width-20,t)):(e.moveTo(Ve,t),e.strokeStyle=O(n,"grid-lines",d),e.lineTo(a.width-Ve,t))}e.stroke()}return{drawXAxis:function(l,s){e.clearRect(0,a.height-Xe+1,a.width,31);const o=a.height-15,d=ve(l.xAxisScale),r=q(d),c=1-(l.xAxisScale-d);e.font=He,e.textAlign="center",e.textBaseline="middle";for(let d=l.labelFromIndex;d<=l.labelToIndex;d++){const i=d-Ye;if(0!=i%r)continue;const l=t.xLabels[d],[h]=s.toPixels(d,0);let p=0==i%(2*r)?1:c;p=$(p,h,a.width),e.fillStyle=O(n,"x-axis-text",p),e.fillText(l.text,h,o)}},drawYAxis:function(e,a,i){const{yAxisScale:n,yAxisScaleFrom:s,yAxisScaleTo:o,yAxisScaleProgress:b=0,yMinViewport:d,yMinViewportFrom:r,yMinViewportTo:c,yMaxViewport:h,yMaxViewportFrom:p,yMaxViewportTo:y,yMinViewportSecond:u,yMinViewportSecondFrom:g,yMinViewportSecondTo:m,yMaxViewportSecond:f,yMaxViewportSecondFrom:x,yMaxViewportSecondTo:v}=e,M=i&&t.datasets[0].colorName;if(l(e,a,me(o||n),void 0===c?d:c,void 0===y?h:y,s?b:1,M),0<b&&(void 0!==r||void 0!==p)&&l(e,a,me(s),void 0===r?d:r,void 0===p?h:p,1-b,M),i){const{yAxisScaleSecond:a,yAxisScaleSecondFrom:n,yAxisScaleSecondTo:s,yAxisScaleSecondProgress:o=0}=e,d=t.datasets[t.datasets.length-1].colorName;l(e,i,me(s||a),void 0===m?u:m,void 0===v?f:v,n?o:1,d,!0),0<o&&(void 0!==g||void 0!==x)&&l(e,i,me(n),void 0===g?u:g,void 0===x?f:x,1-o,d,!0)}}}}function h(e,t,a,i){function n(e){const{begin:t,end:a}=e;C||v({begin:t,end:a},!0),c(e)&&(W=ce(e,{focusOn:null}),m(L,P),h(W))}function l(e){k.classList.toggle("lovely-chart--state-hidden",!e),requestAnimationFrame(()=>{k.classList.toggle("lovely-chart--state-transparent",!e)})}function s(){k=nt(),k.className="lovely-chart--minimap",k.style.height=`${Re}px`,d(),r(),e.appendChild(k),V={width:L.offsetWidth,height:L.offsetHeight}}function o(){return{width:e.offsetWidth-20,height:Re}}function d(){const{canvas:e,context:t}=g(k,o());L=e,P=t}function r(){A=nt(),A.className="lovely-chart--minimap-ruler",A.innerHTML="<div class=\"lovely-chart--minimap-mask\"></div><div class=\"lovely-chart--minimap-slider\"><div class=\"lovely-chart--minimap-slider-handle\"><span class=\"lovely-chart--minimap-slider-handle-pin\"></span></div><div class=\"lovely-chart--minimap-slider-inner\"></div><div class=\"lovely-chart--minimap-slider-handle\"><span class=\"lovely-chart--minimap-slider-handle-pin\"></span></div></div><div class=\"lovely-chart--minimap-mask\"></div>",I=A.children[1],F(I.children[1],{onCapture:p,onDrag:u,onRelease:y,draggingCursor:"grabbing"}),F(I.children[0],{onCapture:p,onDrag:f,onRelease:y,draggingCursor:"ew-resize"}),F(I.children[2],{onCapture:p,onDrag:x,onRelease:y,draggingCursor:"ew-resize"}),k.appendChild(A)}function c(e){if(!W)return!0;const a=t.datasets.map(({key:e})=>`opacity#${e}`);return a.push("yMaxMinimap"),a.some(t=>W[t]!==e[t])}function h(e={}){const{datasets:i}=t,n={from:0,to:e.totalXWidth},l={begin:0,end:1,totalXWidth:e.totalXWidth,yMin:e.yMinMinimap,yMax:e.yMaxMinimap,availableWidth:V.width,availableHeight:V.height,yPadding:1},s=i.map(({key:t})=>ee(e,t)),o=b(t,i,n,s,l,!0),d=w(l);let r=null,c=null;if(t.hasSecondYAxis){const a=i.find(e=>e.hasOwnYAxis),l={yMin:e.yMinMinimapSecond,yMax:e.yMaxMinimapSecond};r=b(t,[a],n,s,l)[0],c=d.copy(l)}T(P,e,t,n,o,d,r,c,Be,s,a,!0)}function p(t){C=t.target.offsetLeft}function y(){C=null}function u(e,t,{dragOffsetX:a}){const i=V.width-I.offsetWidth,n=be(0,xe(C+a-je,i)),l=n+I.offsetWidth,s=n/V.width,o=l/V.width;v({begin:s,end:o})}function f(e,t,{dragOffsetX:a}){const i=I.offsetLeft+I.offsetWidth-16,n=xe(i,be(0,C+a)),l=n/V.width;v({begin:l})}function x(e,t,{dragOffsetX:a}){const i=I.offsetLeft+16,n=V.width,l=be(i,xe(C+je+a,n)),s=l/V.width;v({end:s})}function v(e,t){let a=Object.assign({},E,e);W&&W.minimapDelta&&!t&&(a=M(a)),a.begin===E.begin&&a.end===E.end||(E=a,O(),!t&&i(E))}function M(e){const t=e.begin-E.begin,a=e.end-E.end,i=ge(t),n=ge(a),l=i?t/i:1,s=n?a/n:1,o=E.begin+ve(i/W.minimapDelta)*W.minimapDelta*l,d=E.end+ve(n/W.minimapDelta)*W.minimapDelta*s;return{begin:o,end:d}}function S(){const{begin:e,end:t}=E;A.children[0].style.width=`${100*e}%`,A.children[1].style.width=`${100*(t-e)}%`,A.children[2].style.width=`${100*(1-t)}%`}let k,L,P,V,A,I,C,W,E={};const O=pe(S);return s(),v(Le),{update:n,toggle:l}}function p(e,t,a,i,n,l){function s(e){_.classList.toggle("lovely-chart--state-loading",e)}function o(e){ie=e,_.classList.toggle("lovely-chart--state-zoomed",e)}function d(){U=nt(),U.className="lovely-chart--tooltip",r(),c(),"ontouchstart"in window?(ae(U,"touchmove",h),ae(U,"touchstart",h),ae(document,"touchstart",p)):(ae(U,"mousemove",h),ae(U,"click",y),ae(document,"mousemove",p)),e.appendChild(U)}function r(){const{canvas:e,context:t}=g(U,a);J=e,$=t}function c(){_=nt(),_.className="lovely-chart--tooltip-balloon",_.innerHTML="<div class=\"lovely-chart--tooltip-title\"></div><div class=\"lovely-chart--tooltip-legend\"></div><div class=\"lovely-chart--spinner\"></div>",ae(_,"click",u),U.appendChild(_)}function h(t){if(!(t.target===_||_.contains(t.target)||ee)){const e=D(U);Q=(t.touches?t.touches[0].clientX:t.clientX)-e.left,G=(t.touches?t.touches[0].clientY:t.clientY)-e.top,le()}}function p(t){null===Q||t.target===U||U.contains(t.target)||f()}function y(t){const e=ee;ee=null,h(t,!0);const a=x();a!==e&&(ee=a)}function u(){if(!_.classList.contains("lovely-chart--state-zoomed")){const e=z.findClosestLabelIndex(Q);n(e)}}function f(e){Q=null,ee=null,m(J,$),H(),!e&&l&&l(null)}function x(){const e=z.findClosestLabelIndex(Q);return e<X.labelFromIndex||e>X.labelToIndex?null:e}function v(e){function n(e,a){return t.isPie?e.slice(X.labelFromIndex,X.labelToIndex+1).reduce((e,t)=>e+t,0):e[a]}if(!Q||!X)return;const s=x();if(!s)return void f(e);const o=F(),d=!t.isPie||o.distance<=K(z);!e&&l&&(t.isPie?l(o):l(s));const[r]=z.toPixels(s,0),c=t.datasets.map(({key:e,name:t,colorName:a,values:l,hasOwnYAxis:o},d)=>({key:e,name:t,colorName:a,value:n(l,s),hasOwnYAxis:o,originalIndex:d})).filter(({key:e})=>X.filter[e]);c.length&&d?w(c,s):H(),m(J,$),(t.isLines||t.isAreas)&&(t.isLines&&b(c,s),S(r,a.height-Xe,O(i,"grid-lines")))}function b(e,t){e.forEach(({value:e,colorName:a,hasOwnYAxis:n,originalIndex:l})=>{const s=t-X.labelFromIndex,o=n?q[s]:Y[l][s];if(o){const[e,l]=n?Z.toPixels(t,o.stackValue):z.toPixels(t,o.stackValue);M([e,l],O(i,`${a}-line`),O(i,"background"))}})}function M([e,t],a,i){$.strokeStyle=a,$.fillStyle=i,$.lineWidth=2,$.beginPath(),$.arc(e,t,4,0,2*ue),$.fill(),$.stroke()}function S(e,t,a){$.strokeStyle=a,$.lineWidth=1,$.beginPath(),$.moveTo(e,0),$.lineTo(e,t),$.stroke()}function k(e){const a=(X.labelFromIndex+X.labelToIndex)/2,{angle:i}=F(),n=t.isPie?i>ue/2:e<a;return n?Q+Ne:Q-(_.offsetWidth+Ne)}function L(){return t.isPie?`${G}px`:0}function w(e,a){_.style.transform=`translate3D(${k(a)}px, ${L()}, 0)`,_.classList.add("lovely-chart--state-shown"),t.isPie?E(null,e):se(T(t,a),e)}function T(e,t){return ie?te(e.xLabels[X.labelFromIndex+1],e.xLabels[X.labelToIndex-1])?j(e.xLabels[t],{isShort:!0,displayYear:!1,displayHours:!0}):e.xLabels[t].text:B(e.xLabels[t],{isShort:!0})}function P(e,t,a,i,n){const l=0<i?e.slice(0,i).reduce((e,t)=>e+t.value,0):0;return n&&2*(l/a*ue)-ue/2<=n.angle&&n.angle<2*((l+t)/a*ue)-ue/2&&n.distance<=K(z)}function V(e){const a=_.children[0];if(t.isPie)a&&(a.style.display="none");else{"none"===a.style.display&&(a.style.display="");const t=a.querySelector(":not(.lovely-chart--state-hidden)");a.innerHTML&&t?t.innerHTML!==e&&ne(t,e,"lovely-chart--tooltip-title-inner"):a.innerHTML=`<span>${e}</span>`}}function A(e,{name:t,colorName:a,value:i},n){const l=nt();l.className="lovely-chart--tooltip-dataset",l.setAttribute("data-present","true"),l.setAttribute("data-name",t),l.innerHTML=`<span class="lovely-chart--dataset-title">${t}</span><span class="${`lovely-chart--tooltip-dataset-value lovely-chart--position-right lovely-chart--color-${a}`}">${i}</span>`,C(l,i,n);const s=e.querySelector(`[data-total="true"]`);s?e.insertBefore(l,s):e.appendChild(l)}function I(e,{colorName:t,value:a}={},i){e.setAttribute("data-present","true");const n=e.querySelector(`.lovely-chart--tooltip-dataset-value.lovely-chart--color-${t}:not(.lovely-chart--state-hidden)`),l=R(a);n.innerHTML!==l&&ne(n,l,`lovely-chart--tooltip-dataset-value lovely-chart--position-right lovely-chart--color-${t}`),C(e,a,i)}function C(e,a,i){if(!t.isPercentage)return;if(t.isPie)return void Array.from(e.querySelectorAll(`.lovely-chart--percentage-title`)).forEach(t=>t.remove());const n=me(100*(a/i)),l=e.querySelector(`.lovely-chart--percentage-title:not(.lovely-chart--state-hidden)`);if(!l){const t=nt("span");t.className="lovely-chart--percentage-title lovely-chart--position-left",t.innerHTML=`${n}%`,e.prepend(t)}else`${n}%`!==l.innerHTML&&ne(l,`${n}%`,"lovely-chart--percentage-title lovely-chart--position-left")}function W(e){const a=_.children[1];t.isPie&&a.classList.add("lovely-chart--tooltip-legend-pie"),Array.from(a.children).forEach(e=>{!t.isPie&&a.classList.contains("lovely-chart--tooltip-legend-pie")?e.remove():e.setAttribute("data-present","false")});const i=e.reduce((e,t)=>e+t.value,0),n=F(),l=t.isPie?e.filter(({value:t},a)=>P(e,t,i,a,n)):e;l.forEach(e=>{const t=a.querySelector(`[data-name="${e.name}"]`);t?I(t,e,i):A(a,e,i)}),t.isBars&&t.isStacked&&N(a,R(i)),Array.from(a.querySelectorAll("[data-present=\"false\"]")).forEach(e=>{e.remove()})}function E(e,t){V(e),W(t)}function N(e,t){const a=e.querySelector(`[data-total="true"]`),i=`lovely-chart--tooltip-dataset-value lovely-chart--position-right`;if(!a){const a=nt();a.className="lovely-chart--tooltip-dataset",a.setAttribute("data-present","true"),a.setAttribute("data-total","true"),a.innerHTML=`<span>All</span><span class="${i}">${t}</span>`,e.appendChild(a)}else{a.setAttribute("data-present","true");const e=a.querySelector(`.lovely-chart--tooltip-dataset-value:not(.lovely-chart--state-hidden)`);e.innerHTML!==t&&ne(e,t,i)}}function H(){_.classList.remove("lovely-chart--state-shown")}function F(){var e=Math.sqrt,t=Math.atan2;const{width:a,height:i}=U.getBoundingClientRect(),n=[a/2,i/2],l=t(G-n[1],Q-n[0]),s=e((Q-n[0])**2+(G-n[1])**2);return{angle:l>=-ue/2?l:2*ue+l,distance:s}}function D(e){return e.getBoundingClientRect()}let X,Y,z,q,Z,U,J,$,_,Q,G,ee=null,ie=!1;const le=pe(v),se=he(E,400,!0,!0);return d(),{update:function(e,t,a,i,n){X=e,Y=t,z=a,q=i,Z=n,v(!0)},toggleSpinner:s,toggleIsZoomed:o}}function y(e,t,a){function i(){if(s){const e=s;e.classList.add("lovely-chart--state-hidden"),setTimeout(()=>{e.parentNode.removeChild(e)},500)}n(),s.classList.add("lovely-chart--state-transparent"),requestAnimationFrame(()=>{s.classList.remove("lovely-chart--state-transparent")})}function n(){s=nt(),s.className="lovely-chart--tools",2>t.datasets.length&&(s.className+=" lovely-chart--state-hidden"),t.datasets.forEach(({key:e,name:t,colorName:a})=>{const i=nt("a");i.href="#",i.dataset.key=e,i.className=`lovely-chart--button lovely-chart--color-${a} lovely-chart--state-checked`,i.innerHTML=`<span class="lovely-chart--button-check"></span><span class="lovely-chart--button-label">${t}</span>`,i.addEventListener("click",t=>{t.preventDefault(),i.dataset.clickPrevented||l(i),delete i.dataset.clickPrevented}),F(i,{onLongPress:()=>{"ontouchstart"in window||(i.dataset.clickPrevented="true"),l(i,!0)}}),s.appendChild(i)}),e.appendChild(s)}function l(e,t=!1){const i=Array.from(s.getElementsByTagName("a")),n=1===s.querySelectorAll(".lovely-chart--state-checked").length;e&&(e.classList.contains("lovely-chart--state-checked")&&n?t?(i.forEach(e=>e.classList.add("lovely-chart--state-checked")),e.classList.remove("lovely-chart--state-checked")):(e.classList.remove("lovely-chart--state-shake"),requestAnimationFrame(()=>{e.classList.add("lovely-chart--state-shake")})):t?(i.forEach(e=>e.classList.remove("lovely-chart--state-checked")),e.classList.add("lovely-chart--state-checked")):e.classList.toggle("lovely-chart--state-checked"));const l={};i.forEach(e=>{l[e.dataset.key]=e.classList.contains("lovely-chart--state-checked")}),a(l)}let s;return n(),l(),{redraw:i}}function u(e,t,a,i,n,l,s){function o(a,n){if(!t.dataSource||g)return;p=a,i.zoom(B(e.xLabels[n])),l.toggleSpinner(!0),l.toggleIsZoomed(!0);const{value:s}=e.xLabels[n],o=t.zoomToPie?Promise.resolve(h(a)):r(new Date(s));o.then(e=>c(e,n))}function d(){return g}function r(e){const{dataSource:a}=t,i=e.getMonth()+1,n=e.getDate(),l=`${e.getFullYear()}-${10>i?"0":""}${i}/${10>n?"0":""}${n}`;return fetch(`${a}/${l}.json`).then(e=>e.json())}function c(i,o){l.toggleSpinner(!1);const d=1/e.xLabels.length,r=o/(e.xLabels.length-1),c={};e.datasets.forEach(({key:e})=>c[e]=!1),a.update({range:{begin:r-d/2,end:r+d/2},filter:c}),setTimeout(()=>{u=g?null:B(e.xLabels[o]),Object.assign(e,x(i,t.datasetColors,g||t.zoomToPie?"days":"hours")),t.noMinimapOnZoom&&(n.toggle(g),s.redraw()),a.update({range:{begin:Ue-Ze,end:Ue+Ze},focusOn:null},!0);const l=g||t.zoomToPie?e.xLabels.length:e.xLabels.length/24,d=1/l/2;let r,c;g?(r={begin:p.begin,end:p.end},c=t.noMinimapOnZoom?p.filter:y.filter):t.noMinimapOnZoom?(r={begin:0,end:1},c={},e.datasets.forEach(({key:e})=>c[e]=!0)):(r={begin:Ue-d,end:Ue+d},c=p.filter),a.update({range:r,filter:c,minimapDelta:g?null:r.end-r.begin}),g=!g},qe)}function h(e){return f(t).then(t=>{const a=Object.assign({},t);return a.columns=t.columns.map(t=>{const a=t.slice(e.labelFromIndex+1,e.labelToIndex+1);return a.unshift(t[0]),a}),Object.keys(a.types).forEach(e=>{"x"!==e&&(a.types[e]="pie")}),a.pie=!0,a})}let p,y,u,g=!1;return{zoomIn:o,zoomOut:function(e){y=e,l.toggleIsZoomed(!1);const a=me((e.labelFromIndex+e.labelToIndex)/2);f(t).then(e=>c(e,a))},isZoomed:d}}function g(e,{width:t,height:a}){const i=nt("canvas");i.width=t*Se,i.height=a*Se,i.style.width="100%",i.style.height=`${a}px`;const n=i.getContext("2d");return n.scale(Se,Se),e.appendChild(i),{canvas:i,context:n}}function m(e,t){t.clearRect(0,0,e.width,e.height)}function f(e){const{data:t,dataSource:a}=e;if(t)return Promise.resolve(t);return a?fetch(`${a}/overview.json`).then(e=>e.json()):void 0}function x(e,t,a){const{datasets:i,labels:n}=v(e,t);let l=1/0,s=-Infinity;return i.forEach(e=>{const{min:t,max:a}=oe(e.values);t<l&&(l=t),a>s&&(s=a),e.yMin=t,e.yMax=a}),{datasets:i,yMin:l,yMax:s,xLabels:"hours"===a?X(n):D(n),hasSecondYAxis:e.y_scaled,isStacked:e.stacked,isPercentage:e.percentage,isPie:e.pie,isLines:i.some(({type:e})=>"line"===e),isBars:i.some(({type:e})=>"bar"===e),isAreas:i.some(({type:e})=>"area"===e)}}function v(e,t={}){const{columns:a,names:n,types:l,y_scaled:s}=e;let o=[];const d=[];return a.forEach((e,r)=>{const i=e.shift();return i===ke?void(o=e):void d.push({key:i,colorName:t[i],name:n[i],type:l[i],values:e,hasOwnYAxis:s&&r===a.length-1})}),{datasets:d,labels:o}}function b(e,t,a,n,l,s){let o=t.map(({values:e})=>e.slice(a.from,a.to+1));e.isPie&&!s&&(o=L(o));const d=o.map((t,l)=>t.map((t,i)=>{let s=t;return e.isStacked&&(s*=n[l]),{labelIndex:a.from+i,value:t,visibleValue:s,stackOffset:0,stackValue:s}}));return e.isPercentage&&S(d,l),e.isStacked&&k(d),d}function M(e){return re(e.map(e=>e.map(({visibleValue:e})=>e)))}function S(e,t){const a=M(e);e.forEach(e=>{e.forEach((e,i)=>{e.percent=e.visibleValue/a[i],e.visibleValue=e.percent*t.yMax})})}function k(e){const t=[];e.forEach(e=>{e.forEach((e,a)=>{t[a]===void 0&&(t[a]=0),e.stackOffset=t[a],t[a]+=e.visibleValue,e.stackValue=t[a]})})}function L(e){return e.map(e=>[e.reduce((e,t)=>e+t,0)])}function w(e){function t(e,t){return[e*y-u,r-(t*m-f)]}function a(e){return me((e+u)/y)}const{begin:i,end:n,totalXWidth:l,yMin:s,yMax:o,availableWidth:d,availableHeight:r,xPadding:c=0,yPadding:h=0}=e;let p=d;0===i&&(p-=c),1===n&&(p-=c);const y=p/((n-i)*l);let u=i*l*y;0===i&&(u-=c);const g=r-h,m=g/(o-s),f=s*m;return{toPixels:t,findClosestLabelIndex:a,copy:function(t,a){return w(ce(e,t),a)},getCenter:function(){return[d/2,r-g/2]},getSize:function(){return[d,g]},getParams:function(){return e}}}function T(e,t,a,n,l,s,o,d,r,c,h,p){if(a.datasets.forEach(({colorName:y,type:u,hasOwnYAxis:g},m)=>{if(!c[m])return;const i={color:O(h,`${y}-line`),lineWidth:r,opacity:a.isStacked?1:c[m]},f="pie"===u&&p?"bar":u;let x=g?o:l[m],v=g?d:s;if("area"===f){const{yMin:e,yMax:t}=s.getParams(),a=t-e,i=[{labelIndex:n.from,stackValue:0},{labelIndex:n.to,stackValue:0}],o=[{labelIndex:n.to,stackValue:a},{labelIndex:n.from,stackValue:a}];x=de([l[m-1]||i,o])}if("pie"===f&&(i.center=s.getCenter(),i.radius=K(s),i.pointerVector=t.focusOn),"bar"===f){const[e]=s.toPixels(0,0),[a]=s.toPixels(1,0);i.lineWidth=a-e,i.focusOn=t.focusOn}P(f,e,x,v,i)}),t.focusOn&&a.isBars){const[a]=s.toPixels(0,0),[i]=s.toPixels(1,0);I(e,s,{focusOn:t.focusOn,color:O(h,"mask"),lineWidth:i-a})}}function P(e,...t){return"line"===e?V(...t):"bar"===e?A(...t):"area"===e?C(...t):"pie"===e?W(...t):void 0}function V(e,t,a,i){e.beginPath();for(let n=0,s=t.length;n<s;n++){const{labelIndex:i,stackValue:l}=t[n],[s,o]=a.toPixels(i,l);e.lineTo(s,o)}e.save(),e.strokeStyle=i.color,e.lineWidth=i.lineWidth,e.globalAlpha=i.opacity,e.lineJoin="bevel",e.lineCap="butt",e.stroke(),e.restore()}function A(e,t,a,i){const{yMin:n}=a.getParams();e.save(),e.globalAlpha=i.opacity,e.fillStyle=i.color;for(let s=0,o=t.length;s<o;s++){const{labelIndex:l,stackValue:o,stackOffset:d=0}=t[s],[,r]=a.toPixels(l,be(d,n)),[c,h]=a.toPixels(l,o),p=c-i.lineWidth/2,y=1===i.opacity?i.lineWidth+Oe:i.lineWidth;e.fillRect(p,h,y,r-h)}e.restore()}function I(e,t,a){const[i,n]=t.getCenter(),[l,s]=t.getSize(),[o]=t.toPixels(a.focusOn,0);e.fillStyle=a.color,e.fillRect(i-l/2,n-s/2,o-a.lineWidth/2+Oe,s),e.fillRect(o+a.lineWidth/2,n-s/2,l-(o+a.lineWidth/2),s)}function C(e,t,a,i){e.beginPath();for(let n=0,s=t.length;n<s;n++){const{labelIndex:i,stackValue:l}=t[n],[s,o]=a.toPixels(i,l);e.lineTo(s,o)}e.save(),e.fillStyle=i.color,e.lineWidth=i.lineWidth,e.globalAlpha=i.opacity,e.lineJoin="bevel",e.lineCap="butt",e.fill(),e.restore()}function W(e,t,a,i){const{visibleValue:n,stackValue:l,stackOffset:s=0}=t[0];if(!n)return;const{yMin:o,yMax:d}=a.getParams(),r=1/(d-o),c=n*r,h=2*(s*r*ue)-ue/2,p=2*(l*r*ue)-ue/2,{radius:g=120,center:[m,f],pointerVector:u}=i,y=u&&h<=u.angle&&u.angle<p&&u.distance<=g?Ee:0,x=(h+p)/2,v=Math.cos(x),b=Math.sin(x),M=v*y,S=b*y;e.save(),e.beginPath(),e.fillStyle=i.color,e.moveTo(m+M,f+S),e.arc(m+M,f+S,g,h,p),e.lineTo(m+M,f+S),e.fill(),e.font=`700 ${Q(c,g)}px Helvetica, Arial, sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle="white";const k=G(c,g);e.fillText(`${me(100*c)}%`,m+v*k+M,f+b*k+S),e.restore()}function E(e){const t={};return["skin-day","skin-night"].forEach(a=>{t[a]={},Object.keys(et[a]).forEach(i=>{const n=N(et[a][i]);i.startsWith(`palette-${e}`)?t[a][i.replace(`palette-${e}-`,"")]=n:!i.startsWith(`palette-`)&&(t[a][i]=n)})}),t}function O(e,t,a){return H(e[tt][t],a)}function N(e){const[t,a]=e.replace("#","").split("/");return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16),a?parseFloat(a):1]}function H([e,t,i,n=1],a=1){return`rgba(${e}, ${t}, ${i}, ${n*a})`}function F(e,t){function a(a){l=a,"mousedown"===a.type?(ae(document,"mousemove",n),ae(document,"mouseup",i)):"touchstart"===a.type&&(ae(document,"touchmove",n),ae(document,"touchend",i),ae(document,"touchcancel",i),a.pageX===void 0&&(a.pageX=a.touches[0].pageX)),t.draggingCursor&&document.body.classList.add(`cursor-${t.draggingCursor}`),t.onCapture&&t.onCapture(a),t.onLongPress&&(s=setTimeout(()=>t.onLongPress(),Pe))}function i(a){l&&(s&&(clearTimeout(s),s=null),t.draggingCursor&&document.body.classList.remove(`cursor-${t.draggingCursor}`),ie(document,"mouseup",i),ie(document,"mousemove",n),ie(document,"touchcancel",i),ie(document,"touchend",i),ie(document,"touchmove",n),l=null,t.onRelease&&t.onRelease(a))}function n(a){l&&(s&&(clearTimeout(s),s=null),"touchmove"===a.type&&a.pageX===void 0&&(a.pageX=a.touches[0].pageX),t.onDrag&&t.onDrag(a,l,{dragOffsetX:a.pageX-l.pageX}))}let l=null,s=null;ae(e,"mousedown",a),ae(e,"touchstart",a)}function D(e){return e.map(e=>{const t=new Date(e),a=t.getDate(),i=$e[t.getMonth()];return{value:e,text:`${a} ${i}`}})}function X(e){return e.map(e=>{const t=new Date(e),a=t.getUTCHours(),i=t.getUTCMinutes();return{value:e,text:`${10>a?"0":""}${a}:${10>i?"0":""}${i}`}})}function Y(e,t=1){if(1e6<=e)return z(e/1e6,t)+"M";return 1e3<=e?z(e/1e3,t)+"K":e}function z(e,t){return e.toFixed(t).replace(/(\d{3,})\.\d+/,"$1").replace(/\.0+$/,"")}function R(e){return(e+"").replace(/\d(?=(\d{3})+$)/g,"$& ")}function B(e,{isShort:t=!1}={}){return j(e,{isShort:t,displayWeekDay:!0})}function j(e,{isShort:t=!1,displayWeekDay:a=!1,displayYear:i=!0,displayHours:n=!1}={}){const{value:l}=e,s=new Date(l),o=t?$e:Je,d=t?Ke:_e;let r=`${s.getUTCDate()} ${o[s.getUTCMonth()]}`;return a&&(r=`${d[s.getUTCDay()]}, `+r),i&&(r+=` ${s.getUTCFullYear()}`),n&&(r+=`, ${("0"+s.getUTCHours()).slice(-2)}:${("0"+s.getUTCMinutes()).slice(-2)}`),r}function q(e){return fe(2,e)}function Z(e){return Me(Math.log2(e||1))}function U(e){return at[e]||at[at.length-1]}function J(e){return at.findIndex(t=>t>=e)||at.length-1}function $(e,t,a){const i=xe(t+Ve,a-t);return 40>=i&&(e=xe(1,e,i/40)),e}function _(e,t){return t-Ve<=20?xe(1,e,(t-Ve)/20):e}function K(e){return xe(...e.getSize())*We}function Q(e,t){return(t+150*e)/8}function G(e,t){return .99<=e?0:xe(1-Math.log(30*e)/5,4/5)*t}function ee(e,t){return be(0,xe(2*e[`opacity#${t}`]-1,1))}function te(e,t){return ge(t.value-e.value)>Qe}function ae(e,t,a){e.addEventListener(t,a)}function ie(e,t,a){e.removeEventListener(t,a)}function ne(e,t,a="",i=!1){const n=e.parentNode;n.classList.add("lovely-chart--transition-container");const l=nt(e.tagName);l.className=`${a} lovely-chart--transition lovely-chart--position-${i?"top":"bottom"} lovely-chart--state-hidden`,l.innerHTML=t;const s=a.length?`.${a.split(" ").join(".")}`:"",o=n.querySelectorAll(`${s}.lovely-chart--state-hidden`);return o.forEach(t=>t.remove()),e.classList.add("lovely-chart--transition"),e.classList.remove("lovely-chart--position-bottom","lovely-chart--position-top"),e.classList.add(i?"lovely-chart--position-bottom":"lovely-chart--position-top"),n.insertBefore(l,e.nextSibling),le(l),se(e),l}function le(e){e.classList.remove("lovely-chart--state-animated"),e.classList.add("lovely-chart--state-animated"),e.classList.remove("lovely-chart--state-hidden")}function se(e){e.classList.remove("lovely-chart--state-animated"),e.classList.add("lovely-chart--state-animated"),e.classList.add("lovely-chart--state-hidden")}function oe(e){const t=e.length;let a=e[0],n=e[0];for(let l=0;l<t;l++){const t=e[l];t>a?a=t:t<n&&(n=t)}return{max:a,min:n}}function de(e){return[].concat.apply([],e)}function re(e){const t=[],a=e.length;for(let n=0,i=e[0].length;n<i;n++){t[n]=0;for(let i=0;i<a;i++)t[n]+=e[i][n]}return t}function ce(e,t){return new Proxy({},{get:(a,i)=>void 0===t[i]?e[i]:t[i]})}function he(e,t,a=!0,i=!0){let n,l,s=!1;return function(...o){n=o,l=!0,s||(a&&(l=!1,e(...n)),s=!0,setTimeout(()=>{s=!1,i&&l&&e(...n)},t))}}function pe(e){let t,a=!1;return function(...i){t=i,a||(a=!0,requestAnimationFrame(()=>{a=!1,e(...t)}))}}function ye(e,t,a=!0,i=!0){let n=null;return function(){n?(clearTimeout(n),n=null):a&&e(),n=setTimeout(()=>{i&&e(),n=null},t)}}window.LovelyChart={create:function(t){function a(){L.update()}function i(){n(),C=r(P,t.title,S),l(),L=e(k,I,s),W=c(A,k,I,X),O=h(P,k,X,o),N=p(P,k,I,X,M,v),H=y(P,k,d),F=u(k,t,L,C,O,N,H)}function n(){P=nt(),P.className=`lovely-chart--container lovely-chart--palette-${t.palette||Te}`,it(P);const e=document.getElementById(t.containerId);e.appendChild(P)}function l(){const{canvas:e,context:t}=g(P,{width:P.clientWidth,height:Ae});V=e,A=t,I={width:V.offsetWidth,height:V.offsetHeight}}function s(e){D=e;const{datasets:t}=k,a={from:e.labelFromIndex,to:e.labelToIndex},i={begin:e.begin,end:e.end,totalXWidth:e.totalXWidth,yMin:e.yMinViewport,yMax:e.yMaxViewport,availableWidth:I.width,availableHeight:I.height-Xe,xPadding:Ve,yPadding:Ie},n=t.map(({key:t})=>e[`opacity#${t}`]),l=b(k,t,a,n,i),s=w(i);let o=null,d=null;if(k.hasSecondYAxis){const i=t.find(e=>e.hasOwnYAxis),l={yMin:e.yMinViewportSecond,yMax:e.yMaxViewportSecond};o=b(k,[i],a,n,l)[0],d=s.copy(l)}C.setCaption(!F.isZoomed()||te(k.xLabels[e.labelFromIndex+1],k.xLabels[e.labelToIndex-1])?`${j(k.xLabels[e.labelFromIndex+1])}`+" - "+`${j(k.xLabels[e.labelToIndex-1])}`:B(k.xLabels[e.labelFromIndex])),m(V,A),T(A,e,k,a,l,s,o,d,Ce,n,X),k.isPie||(W.drawYAxis(e,s,d),W.drawXAxis(e,s)),O.update(e),N.update(e,l,s,o,d)}function o(e){L.update({range:e})}function d(e){L.update({filter:e})}function v(e){(k.isBars||k.isPie)&&L.update({focusOn:e})}function M(e){F.zoomIn(D,e)}function S(){F.zoomOut(D)}let k,L,P,V,A,I,C,W,O,N,H,F,D;const X=E(t.palette);return f(t).then(e=>{k=x(e,t.datasetColors),i()}),{redraw:a}},setupColors:function(e){et=e},changeSkin:function(e){tt=e}};const Se=window.devicePixelRatio||1,ke="x",Le={begin:.8,end:1},we=300,Te="type-1",Pe=500,Ve=10,Ae=320,Ie=10,Ce=2,We=.9/2,Ee=10,Oe=.5,Ne=20,He="300 10px Helvetica, Arial, sans-serif",Fe=45,De=40,Xe=30,Ye=1,ze=.1,Re=40,Be=1,je=8,qe=we,Ze=.1,Ue=.5,Je=["January","February","March","April","May","June","July","August","September","October","November","December"],$e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Ke=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Qe=86400000,Ge=["begin 200 fast","end 200 fast","labelFromIndex 200 fast floor","labelToIndex 200 fast ceil","xAxisScale 400","yMinViewport","yMaxViewport","yMinViewportSecond","yMaxViewportSecond","yMinMinimap","yMaxMinimap","yMinMinimapSecond","yMaxMinimapSecond","yAxisScale","yAxisScaleSecond"];let et,tt="skin-day";const at=[1,2,8,18,50,100,250,500,1e3,2500,5e3,1e4,25e3,5e4,1e5,25e4,5e5,1e6,25e5,5e6,1e7,25e6,5e7,1e8],it=(()=>{const e=[],t=ye(function(){e.forEach(e=>{e.classList.remove("lovely-chart--state-invisible")})},500,!0,!1),a=ye(function(){e.forEach(e=>{const{top:t,bottom:a}=e.getBoundingClientRect(),i=0>a||t>window.innerHeight;e.classList.toggle("lovely-chart--state-invisible",i)})},500,!1,!0);return function(i){e.push(i),1===e.length&&(window.onscroll=()=>{t(),a()})}})(),nt=(e="div")=>document.createElement(e)})();