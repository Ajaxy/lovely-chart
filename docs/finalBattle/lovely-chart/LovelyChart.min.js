(function(){var ye=Math.PI,ue=Math.round,ge=Math.pow,fe=Math.min,me=Math.floor,xe=Math.max,ve=Math.ceil;function e(e,a,i){function n({range:l={},filter:d={},focusOn:i,minimapDelta:n}={},y){Object.assign(s,l),Object.assign(o,d);const u=p;p=t(e,a,s,o,i,n,u),y||r.forEach(({prop:e,duration:t,options:a})=>{const i=c.get(e),n=i?i.to:u[e];if(n!==void 0&&n!==p[e]){const n=i?a.includes("fast")?u[e]:i.current:u[e];i&&c.remove(e),c.add(e,n,p[e],t,a)}}),c.isRunning()||h()}function l(){i(re(p,c.getState()))}const s={begin:0,end:1},o=function(){const t={};return e.datasets.forEach(({key:e})=>{t[e]=!0}),t}(),r=function(){const t=[],a=e.datasets.map(({key:e})=>`opacity#${e} 300`);return oe([_e,a]).forEach(e=>{const[a,i,...n]=e.split(" ");t.push({prop:a,duration:i,options:n})}),t}(),c=d(l),h=he(l);let p={};return{update:n}}function t(e,t,i,o,d,r,c){const{begin:h,end:p}=i,y=e.xLabels.length-1,u=xe(0,ve(y*h)),g=fe(me(y*p),y),f=l(t.width,u,g),m=e.isStacked?n(e,o,u,g,c):a(e,o,u,g,c),x=s(t.height,m.yMinViewport,m.yMaxViewport),v=e.hasSecondYAxis&&s(t.height,m.yMinViewportSecond,m.yMaxViewportSecond),b=J(x);if(m.yMinViewport-=m.yMinViewport%b,v){const e=J(v);m.yMinViewportSecond-=m.yMinViewportSecond%e}const M={};return e.datasets.forEach(({key:e})=>{M[`opacity#${e}`]=o[e]?1:0}),Object.assign({totalXWidth:y,xAxisScale:f,yAxisScale:x,yAxisScaleSecond:v,labelFromIndex:xe(0,u-1),labelToIndex:fe(g+1,y),filter:Object.assign({},o),focusOn:void 0===d?c.focusOn:d,minimapDelta:void 0===r?c.minimapDelta:r},m,M,i)}function a(e,t,a,n,l){const s=e.hasSecondYAxis&&e.datasets.slice(-1)[0],o=e.datasets.filter(e=>t[e.key]&&e!==s),d=i(e,a,n,l,o);if(s){const o=t[s.key]?[s]:[],{yMinViewport:r,yMaxViewport:c,yMinMinimap:h,yMaxMinimap:p}=i(e,a,n,l,[s]);Object.assign(d,{yMinViewportSecond:r,yMaxViewportSecond:c,yMinMinimapSecond:h,yMaxMinimapSecond:p})}return d}function i(e,t,a,i,n){const{min:l=i.yMinMinimap,max:s=i.yMaxMinimap}=se(oe(n.map(({yMax:e,yMin:t})=>[e,t]))),o=l/s>De?l:0;let d,r;if(0===t&&a===e.xLabels.length-1)d=o,r=s;else{const e=n.map(({values:e})=>e),l=e.map(e=>e.slice(t,a+1)),s=se(oe(l)),o=s.min===void 0?i.yMinViewport:s.min;r=s.max===void 0?i.yMaxViewport:s.max,d=o/r>De?o:0}return{yMinViewport:d,yMaxViewport:r,yMinMinimap:o,yMaxMinimap:s}}function n(e,t,a,i,n){const l=e.datasets.filter(e=>t[e.key]),s=l.map(({values:e})=>e),o=s.length?de(s):[],{max:d=n.yMaxMinimap}=se(o),{max:r=n.yMaxViewport}=se(o.slice(a,i+1));return{yMinViewport:0,yMaxViewport:r,yMinMinimap:0,yMaxMinimap:d}}function l(e,t,a){const i=me(e/Ne);return Z((a-t)/i)}function s(e,t,a){const i=me((e-Fe)/He);return U((a-t)/i)}function o(e){return 1-ge(1-e,1.675)}function d(e){function t(e,t,a,i,o){l[e]={from:t,to:a,duration:i,options:o,current:t,startedAt:Date.now(),progress:0},s||(s=requestAnimationFrame(n))}function a(e){delete l[e],i()||(cancelAnimationFrame(s),s=null)}function i(){return!!Object.keys(l).length}function n(){const t={};Object.keys(l).forEach(e=>{const{startedAt:i,from:n,to:s,duration:r=ke,options:d}=l[e],c=fe(1,(Date.now()-i)/r);let h=n+(s-n)*o(c);d.includes("ceil")?h=ve(h):d.includes("floor")&&(h=me(h)),l[e].current=h,l[e].progress=c,t[e]=h,1===c&&a(e)}),e(t),i()&&(s=requestAnimationFrame(n))}const l={};let s=null;return{add:t,remove:a,get:function(e){return l[e]},getState:function(){const e={};return Object.keys(l).forEach(t=>{const{current:a,from:i,to:n,progress:s}=l[t];e[t]=a,e[`${t}From`]=i,e[`${t}To`]=n,e[`${t}Progress`]=s}),e},isRunning:i}}function r(e,t,a){function i(e){c.innerHTML?c.innerHTML!==e&&(c=ie(c,e,"lovely-chart--header-caption lovely-chart--position-right")):(c.innerHTML=e,p=!1)}function n(e){h=!0,r=ie(d,"Zoom Out","lovely-chart--header-title lovely-chart--header-zoom-out-control"),te(r,"click",s),i(e)}function l(){o=tt(),o.className="lovely-chart--header",d=tt(),d.className="lovely-chart--header-title",d.innerHTML=t,o.appendChild(d),c=tt(),c.className="lovely-chart--header-caption lovely-chart--position-right",o.appendChild(c),e.appendChild(o)}function s(){h=!0,d=ie(r,t,"lovely-chart--header-title",!0),a()}let o,d,r,c,h=!1,p=!0;const y=ce(i,400,!1,!0);return l(),{setCaption:y,zoom:n}}function c(e,t,a,n){function l(t,i,l,s,o,d=1,r=null,c=!1){const h=J(l),p=ve(s/h)*h,y=me(o/h)*h;e.font=Oe,e.textAlign=c?"right":"left",e.textBaseline="bottom",e.lineWidth=1,e.beginPath();for(let u=p;u<=y;u+=h){const[,t]=i.toPixels(0,u),l=_(d,t);e.fillStyle=r?O(n,`${r}-text`,l):O(n,"y-axis-text",l),c?e.fillText(Y(u),a.width-Pe,t-5):e.fillText(Y(u),Pe,t-5),c?(e.strokeStyle=O(n,`${r}-text`,d),e.moveTo(a.width-Pe,t),e.lineTo(a.width-20,t)):(e.moveTo(Pe,t),e.strokeStyle=O(n,"grid-lines",d),e.lineTo(a.width-Pe,t))}e.stroke()}return{drawXAxis:function(l,s){e.clearRect(0,a.height-Fe+1,a.width,31);const o=a.height-15,d=me(l.xAxisScale),r=q(d),c=1-(l.xAxisScale-d);e.font=Oe,e.textAlign="center",e.textBaseline="middle";for(let d=l.labelFromIndex;d<=l.labelToIndex;d++){const i=d-Xe;if(0!=i%r)continue;const l=t.xLabels[d],[h]=s.toPixels(d,0);let p=0==i%(2*r)?1:c;p=$(p,h,a.width),e.fillStyle=O(n,"x-axis-text",p),e.fillText(l.text,h,o)}},drawYAxis:function(e,a,i){const{yAxisScale:n,yAxisScaleFrom:s,yAxisScaleTo:o,yAxisScaleProgress:b=0,yMinViewport:d,yMinViewportFrom:r,yMinViewportTo:c,yMaxViewport:h,yMaxViewportFrom:p,yMaxViewportTo:y,yMinViewportSecond:u,yMinViewportSecondFrom:g,yMinViewportSecondTo:f,yMaxViewportSecond:m,yMaxViewportSecondFrom:x,yMaxViewportSecondTo:v}=e,M=i&&t.datasets[0].colorName;if(l(e,a,ue(o||n),void 0===c?d:c,void 0===y?h:y,s?b:1,M),0<b&&(void 0!==r||void 0!==p)&&l(e,a,ue(s),void 0===r?d:r,void 0===p?h:p,1-b,M),i){const{yAxisScaleSecond:a,yAxisScaleSecondFrom:n,yAxisScaleSecondTo:s,yAxisScaleSecondProgress:o=0}=e,d=t.datasets[t.datasets.length-1].colorName;l(e,i,ue(s||a),void 0===f?u:f,void 0===v?m:v,n?o:1,d,!0),0<o&&(void 0!==g||void 0!==x)&&l(e,i,ue(n),void 0===g?u:g,void 0===x?m:x,1-o,d,!0)}}}}function h(e,t,a,i){function n(e){const{begin:t,end:a}=e;C||v({begin:t,end:a},!0),c(e)&&(W=re(e,{focusOn:null}),f(w,V),h(W))}function l(e){k.classList.toggle("lovely-chart--state-hidden",!e),requestAnimationFrame(()=>{k.classList.toggle("lovely-chart--state-transparent",!e)})}function s(){k=tt(),k.className="lovely-chart--minimap",k.style.height=`${Ye}px`,d(),r(),e.appendChild(k),A={width:w.offsetWidth,height:w.offsetHeight}}function o(){return{width:e.offsetWidth-20,height:Ye}}function d(){const{canvas:e,context:t}=g(k,o());w=e,V=t}function r(){T=tt(),T.className="lovely-chart--minimap-ruler",T.innerHTML="<div class=\"lovely-chart--minimap-mask\"></div><div class=\"lovely-chart--minimap-slider\"><div class=\"lovely-chart--minimap-slider-handle\"><span class=\"lovely-chart--minimap-slider-handle-pin\"></span></div><div class=\"lovely-chart--minimap-slider-inner\"></div><div class=\"lovely-chart--minimap-slider-handle\"><span class=\"lovely-chart--minimap-slider-handle-pin\"></span></div></div><div class=\"lovely-chart--minimap-mask\"></div>",I=T.children[1],F(I.children[1],{onCapture:p,onDrag:u,onRelease:y,draggingCursor:"grabbing"}),F(I.children[0],{onCapture:p,onDrag:m,onRelease:y,draggingCursor:"ew-resize"}),F(I.children[2],{onCapture:p,onDrag:x,onRelease:y,draggingCursor:"ew-resize"}),k.appendChild(T)}function c(e){if(!W)return!0;const a=t.datasets.map(({key:e})=>`opacity#${e}`);return a.push("yMaxMinimap"),a.some(t=>W[t]!==e[t])}function h(e={}){const{datasets:i}=t,n={from:0,to:e.totalXWidth},l={begin:0,end:1,totalXWidth:e.totalXWidth,yMin:e.yMinMinimap,yMax:e.yMaxMinimap,availableWidth:A.width,availableHeight:A.height,yPadding:1},s=i.map(({key:t})=>ee(e,t)),o=b(t,i,n,s,l,!0),d=L(l);let r=null,c=null;if(t.hasSecondYAxis){const a=i.find(e=>e.hasOwnYAxis),l={yMin:e.yMinMinimapSecond,yMax:e.yMaxMinimapSecond};r=b(t,[a],n,s,l)[0],c=d.copy(l)}P(V,e,t,n,o,d,r,c,ze,s,a,!0)}function p(t){C=t.target.offsetLeft}function y(){C=null}function u(e,t,{dragOffsetX:a}){const i=A.width-I.offsetWidth,n=xe(0,fe(C+a-Re,i)),l=n+I.offsetWidth,s=n/A.width,o=l/A.width;v({begin:s,end:o})}function m(e,t,{dragOffsetX:a}){const i=I.offsetLeft+I.offsetWidth-16,n=fe(i,xe(0,C+a)),l=n/A.width;v({begin:l})}function x(e,t,{dragOffsetX:a}){const i=I.offsetLeft+16,n=A.width,l=xe(i,fe(C+Re+a,n)),s=l/A.width;v({end:s})}function v(e,t){let a=Object.assign({},E,e);W&&W.minimapDelta&&!t&&(a=M(a)),a.begin===E.begin&&a.end===E.end||(E=a,O(),!t&&i(E))}function M(e){var t=Math.abs;const a=e.begin-E.begin,i=e.end-E.end,n=t(a),l=t(i),s=n?a/n:1,o=l?i/l:1,d=E.begin+me(n/W.minimapDelta)*W.minimapDelta*s,r=E.end+me(l/W.minimapDelta)*W.minimapDelta*o;return{begin:d,end:r}}function S(){const{begin:e,end:t}=E;T.children[0].style.width=`${100*e}%`,T.children[1].style.width=`${100*(t-e)}%`,T.children[2].style.width=`${100*(1-t)}%`}let k,w,V,A,T,I,C,W,E={};const O=he(S);return s(),v(Se),{update:n,toggle:l}}function p(e,t,a,i,n,l){function s(e){z.classList.toggle("lovely-chart--state-loading",e)}function o(e){J=e,z.classList.toggle("lovely-chart--state-zoomed",e)}function d(){X=tt(),X.className="lovely-chart--tooltip",r(),c(),"ontouchstart"in window?(te(X,"touchmove",h),te(X,"touchstart",h),te(document,"touchstart",p)):(te(X,"mousemove",h),te(X,"click",y),te(document,"mousemove",p)),e.appendChild(X)}function r(){const{canvas:e,context:t}=g(X,a);D=e,Y=t}function c(){z=tt(),z.className="lovely-chart--tooltip-balloon",z.innerHTML="<div class=\"lovely-chart--tooltip-title\"></div><div class=\"lovely-chart--tooltip-legend\"></div><div class=\"lovely-chart--spinner\"></div>",te(z,"click",u),X.appendChild(z)}function h(t){if(!(t.target===z||z.contains(t.target)||Z)){const e=C(X);j=(t.touches?t.touches[0].clientX:t.clientX)-e.left,q=(t.touches?t.touches[0].clientY:t.clientY)-e.top,U()}}function p(t){null===j||t.target===X||X.contains(t.target)||m()}function y(t){const e=Z;Z=null,h(t,!0);const a=x();a!==e&&(Z=a)}function u(){if(!z.classList.contains("lovely-chart--state-zoomed")){const e=N.findClosestLabelIndex(j);n(e)}}function m(e){j=null,Z=null,f(D,Y),T(),!e&&l&&l(null)}function x(){const e=N.findClosestLabelIndex(j);return e<W.labelFromIndex||e>W.labelToIndex?null:e}function v(e){if(!j||!W)return;const n=x();if(!n)return void m(e);const s=I(),o=!t.isPie||s.distance<=K(N);!e&&l&&(t.isPie?l(s):l(n));const[d]=N.toPixels(n,0),r=t.datasets.map(({key:e,name:t,colorName:a,values:l,hasOwnYAxis:s},o)=>({key:e,name:t,colorName:a,value:l[n],hasOwnYAxis:s,originalIndex:o})).filter(({key:e})=>W.filter[e]);r.length&&o?L(r,n):T(),f(D,Y),(t.isLines||t.isAreas)&&(t.isLines&&b(r,n),S(d,a.height-Fe,O(i,"grid-lines")))}function b(e,t){e.forEach(({value:e,colorName:a,hasOwnYAxis:n,originalIndex:l})=>{const s=t-W.labelFromIndex,o=n?H[s]:E[l][s];if(o){const[e,l]=n?F.toPixels(t,o.stackValue):N.toPixels(t,o.stackValue);M([e,l],O(i,`${a}-line`),O(i,"background"))}})}function M([e,t],a,i){Y.strokeStyle=a,Y.fillStyle=i,Y.lineWidth=2,Y.beginPath(),Y.arc(e,t,4,0,2*ye),Y.fill(),Y.stroke()}function S(e,t,a){Y.strokeStyle=a,Y.lineWidth=1,Y.beginPath(),Y.moveTo(e,0),Y.lineTo(e,t),Y.stroke()}function k(e){const a=(W.labelFromIndex+W.labelToIndex)/2,{angle:i}=I(),n=t.isPie?i>ye/2:e<a;return n?j+Ee:j-(z.offsetWidth+Ee)}function w(){return t.isPie?`${q}px`:0}function L(e,a){if(z.style.transform=`translate3D(${k(a)}px, ${w()}, 0)`,z.classList.add("lovely-chart--state-shown"),t.isPie)V(null,e);else{const i=J?t.xLabels[a].text:B(t.xLabels[a],!0);$(i,e)}}function P(e,t,a,i,n){const l=0<i?e.slice(0,i).reduce((e,t)=>e+t.value,0):0;return n&&2*(l/a*ye)-ye/2<=n.angle&&n.angle<2*((l+t)/a*ye)-ye/2&&n.distance<=K(N)}function V(e,a){const i=z.children[0];if(t.isPie)i.classList.contains("lovely-chart--tooltip-title")&&(i.style.display="none");else{"none"===i.style.display&&(i.style.display="");const t=i.querySelector(":not(.lovely-chart--state-hidden)");i.innerHTML&&t?t.innerHTML!==e&&ie(t,e,"lovely-chart--tooltip-title-inner"):i.innerHTML=`<span>${e}</span>`}const n=z.children[1];Array.from(n.children).forEach(e=>{e.setAttribute("data-present","false")});const l=a.reduce((e,t)=>e+t.value,0),s=I(),o=t.isPie?a.filter(({value:e},t)=>P(a,e,l,t,s)):a;o.forEach(({name:e,colorName:a,value:i})=>{const s=(100*(i/l)).toFixed(0);i=R(i);const o=n.querySelector(`[data-name="${e}"]`),d=`lovely-chart--tooltip-dataset-value lovely-chart--position-right lovely-chart--color-${a}`;if(!o){const a=tt();a.className="lovely-chart--tooltip-dataset",a.setAttribute("data-present","true"),a.setAttribute("data-name",e),a.innerHTML=`<span class="lovely-chart--dataset-title">${e}</span><span class="${d}">${i}</span>`,t.isPercentage&&!t.isPie&&(a.innerHTML=`<span class="lovely-chart--percentage-title lovely-chart--position-left">${s}%</span>`+a.innerHTML);const l=n.querySelector(`[data-total="true"]`);l?n.insertBefore(a,l):n.appendChild(a)}else{o.setAttribute("data-present","true");const e=o.querySelector(`.lovely-chart--tooltip-dataset-value.lovely-chart--color-${a}:not(.lovely-chart--state-hidden)`);if(e.innerHTML!==i&&ie(e,i,d),t.isPercentage&&!t.isPie){const e=o.querySelector(`.lovely-chart--percentage-title:not(.lovely-chart--state-hidden)`);if(!e){const e=tt("span");e.className="lovely-chart--percentage-title lovely-chart--position-left",e.innerHTML=`${s}%`,o.prepend(e)}else e.innerHTML!==s&&ie(e,`${s}%`,"lovely-chart--percentage-title lovely-chart--position-left")}else t.isPercentage&&Array.from(o.querySelectorAll(`.lovely-chart--percentage-title`)).forEach(t=>t.remove())}}),t.isBars&&t.isStacked&&A(n,R(l)),Array.from(n.querySelectorAll("[data-present=\"false\"]")).forEach(e=>{e.remove()})}function A(e,t){const a=e.querySelector(`[data-total="true"]`),i=`lovely-chart--tooltip-dataset-value lovely-chart--position-right`;if(!a){const a=tt();a.className="lovely-chart--tooltip-dataset",a.setAttribute("data-present","true"),a.setAttribute("data-total","true"),a.innerHTML=`<span>All</span><span class="${i}">${t}</span>`,e.appendChild(a)}else{a.setAttribute("data-present","true");const e=a.querySelector(`.lovely-chart--tooltip-dataset-value:not(.lovely-chart--state-hidden)`);e.innerHTML!==t&&ie(e,t,i)}}function T(){z.classList.remove("lovely-chart--state-shown")}function I(){var e=Math.sqrt,t=Math.atan2;const{width:a,height:i}=X.getBoundingClientRect(),n=[a/2,i/2],l=t(q-n[1],j-n[0]),s=e((j-n[0])**2+(q-n[1])**2);return{angle:l>=-ye/2?l:2*ye+l,distance:s}}function C(e){return e.getBoundingClientRect()}let W,E,N,H,F,X,D,Y,z,j,q,Z=null,J=!1;const U=he(v),$=ce(V,400,!0,!0);return d(),{update:function(e,t,a,i,n){W=e,E=t,N=a,H=i,F=n,v(!0)},toggleSpinner:s,toggleIsZoomed:o}}function y(e,t,a){function i(){if(s){const e=s;e.classList.add("lovely-chart--state-hidden"),setTimeout(()=>{e.parentNode.removeChild(e)},500)}n(),s.classList.add("lovely-chart--state-transparent"),requestAnimationFrame(()=>{s.classList.remove("lovely-chart--state-transparent")})}function n(){s=tt(),s.className="lovely-chart--tools",2>t.datasets.length&&(s.className+=" lovely-chart--state-hidden"),t.datasets.forEach(({key:e,name:t,colorName:a})=>{const i=tt("a");i.href="#",i.dataset.key=e,i.className=`lovely-chart--button lovely-chart--color-${a} lovely-chart--state-checked`,i.innerHTML=`<span class="lovely-chart--button-check"></span><span class="lovely-chart--button-label">${t}</span>`,i.addEventListener("click",t=>{t.preventDefault(),i.dataset.clickPrevented||l(i),delete i.dataset.clickPrevented}),F(i,{onLongPress:()=>{"ontouchstart"in window||(i.dataset.clickPrevented="true"),l(i,!0)}}),s.appendChild(i)}),e.appendChild(s)}function l(e,t=!1){const i=Array.from(s.getElementsByTagName("a")),n=1===s.querySelectorAll(".lovely-chart--state-checked").length;e&&(e.classList.contains("lovely-chart--state-checked")&&n?t?(i.forEach(e=>e.classList.add("lovely-chart--state-checked")),e.classList.remove("lovely-chart--state-checked")):(e.classList.remove("lovely-chart--state-shake"),requestAnimationFrame(()=>{e.classList.add("lovely-chart--state-shake")})):t?(i.forEach(e=>e.classList.remove("lovely-chart--state-checked")),e.classList.add("lovely-chart--state-checked")):e.classList.toggle("lovely-chart--state-checked"));const l={};i.forEach(e=>{l[e.dataset.key]=e.classList.contains("lovely-chart--state-checked")}),a(l)}let s;return n(),l(),{redraw:i}}function u(e,t,a,i,n,l,s){function o(a,n){if(!t.dataSource||g)return;p=a,i.zoom(B(e.xLabels[n])),l.toggleSpinner(!0),l.toggleIsZoomed(!0);const{value:s}=e.xLabels[n],o=t.zoomToPie?Promise.resolve(h(a)):r(new Date(s));o.then(e=>c(e,n))}function d(){return g}function r(e){const{dataSource:a}=t,i=e.getMonth()+1,n=e.getDate(),l=`${e.getFullYear()}-${10>i?"0":""}${i}/${10>n?"0":""}${n}`;return fetch(`${a}/${l}.json`).then(e=>e.json())}function c(i,o){l.toggleSpinner(!1);const d=1/e.xLabels.length,r=o/(e.xLabels.length-1),c={};e.datasets.forEach(({key:e})=>c[e]=!1),a.update({range:{begin:r-d/2,end:r+d/2},filter:c}),setTimeout(()=>{u=g?null:B(e.xLabels[o]),Object.assign(e,x(i,t.datasetColors,g||t.zoomToPie?"days":"hours")),t.noMinimapOnZoom&&(n.toggle(g),s.redraw()),a.update({range:{begin:qe-je,end:qe+je},focusOn:null},!0);const l=g||t.zoomToPie?e.xLabels.length:e.xLabels.length/24,d=1/l/2;let r,c;g?(r={begin:p.begin,end:p.end},c=t.noMinimapOnZoom?p.filter:y.filter):t.noMinimapOnZoom?(r={begin:0,end:1},c={},e.datasets.forEach(({key:e})=>c[e]=!0)):(r={begin:qe-d,end:qe+d},c=p.filter),a.update({range:r,filter:c,minimapDelta:g?null:r.end-r.begin}),g=!g},Be)}function h(e){return m(t).then(t=>{const a=Object.assign({},t);return a.columns=t.columns.map(t=>{const a=t.slice(e.labelFromIndex+1,e.labelToIndex+1);return a.unshift(t[0]),a}),Object.keys(a.types).forEach(e=>{"x"!==e&&(a.types[e]="pie")}),a.pie=!0,a})}let p,y,u,g=!1;return{zoomIn:o,zoomOut:function(e){y=e,l.toggleIsZoomed(!1);const a=ue((e.labelFromIndex+e.labelToIndex)/2);m(t).then(e=>c(e,a))},isZoomed:d}}function g(e,{width:t,height:a}){const i=tt("canvas");i.width=t*be,i.height=a*be,i.style.width="100%",i.style.height=`${a}px`;const n=i.getContext("2d");return n.scale(be,be),e.appendChild(i),{canvas:i,context:n}}function f(e,t){t.clearRect(0,0,e.width,e.height)}function m(e){const{data:t,dataSource:a}=e;if(t)return Promise.resolve(t);return a?fetch(`${a}/overview.json`).then(e=>e.json()):void 0}function x(e,t,a){const{datasets:i,labels:n}=v(e,t);let l=1/0,s=-Infinity;return i.forEach(e=>{const{min:t,max:a}=se(e.values);t<l&&(l=t),a>s&&(s=a),e.yMin=t,e.yMax=a}),{datasets:i,yMin:l,yMax:s,xLabels:"hours"===a?D(n):X(n),hasSecondYAxis:e.y_scaled,isStacked:e.stacked,isPercentage:e.percentage,isPie:e.pie,isLines:i.some(({type:e})=>"line"===e),isBars:i.some(({type:e})=>"bar"===e),isAreas:i.some(({type:e})=>"area"===e)}}function v(e,t={}){const{columns:a,names:n,types:l,y_scaled:s}=e;let o=[];const d=[];return a.forEach((e,r)=>{const i=e.shift();return i===Me?void(o=e):void d.push({key:i,colorName:t[i],name:n[i],type:l[i],values:e,hasOwnYAxis:s&&r===a.length-1})}),{datasets:d,labels:o}}function b(e,t,a,n,l,s){let o=t.map(({values:e})=>e.slice(a.from,a.to+1));e.isPie&&!s&&(o=w(o));const d=o.map((t,l)=>t.map((t,i)=>{let s=t;return e.isStacked&&(s*=n[l]),{labelIndex:a.from+i,value:t,visibleValue:s,stackOffset:0,stackValue:s}}));return e.isPercentage&&S(d,l),e.isStacked&&k(d),d}function M(e){return de(e.map(e=>e.map(({visibleValue:e})=>e)))}function S(e,t){const a=M(e);e.forEach(e=>{e.forEach((e,i)=>{e.percent=e.visibleValue/a[i],e.visibleValue=e.percent*t.yMax})})}function k(e){const t=[];e.forEach(e=>{e.forEach((e,a)=>{t[a]===void 0&&(t[a]=0),e.stackOffset=t[a],t[a]+=e.visibleValue,e.stackValue=t[a]})})}function w(e){return e.map(e=>[e.reduce((e,t)=>e+t,0)])}function L(e){function t(e,t){return[e*y-u,r-(t*f-m)]}function a(e){return ue((e+u)/y)}const{begin:i,end:n,totalXWidth:l,yMin:s,yMax:o,availableWidth:d,availableHeight:r,xPadding:c=0,yPadding:h=0}=e;let p=d;0===i&&(p-=c),1===n&&(p-=c);const y=p/((n-i)*l);let u=i*l*y;0===i&&(u-=c);const g=r-h,f=g/(o-s),m=s*f;return{toPixels:t,findClosestLabelIndex:a,copy:function(t,a){return L(re(e,t),a)},getCenter:function(){return[d/2,r-g/2]},getSize:function(){return[d,g]},getParams:function(){return e}}}function P(e,t,a,n,l,s,o,d,r,c,h,p){if(a.datasets.forEach(({colorName:y,type:u,hasOwnYAxis:g},f)=>{if(!c[f])return;const i={color:O(h,`${y}-line`),lineWidth:r,opacity:a.isStacked?1:c[f]},m="pie"===u&&p?"bar":u;let x=g?o:l[f],v=g?d:s;if("area"===m){const{yMin:e,yMax:t}=s.getParams(),a=t-e,i=[{labelIndex:n.from,stackValue:0},{labelIndex:n.to,stackValue:0}],o=[{labelIndex:n.to,stackValue:a},{labelIndex:n.from,stackValue:a}];x=oe([l[f-1]||i,o])}if("pie"===m&&(i.center=s.getCenter(),i.radius=K(s),i.pointerVector=t.focusOn),"bar"===m){const[e]=s.toPixels(0,0),[a]=s.toPixels(1,0);i.lineWidth=a-e,i.focusOn=t.focusOn}V(m,e,x,v,i)}),t.focusOn&&a.isBars){const[a]=s.toPixels(0,0),[i]=s.toPixels(1,0);I(e,s,{focusOn:t.focusOn,color:O(h,"mask"),lineWidth:i-a})}}function V(e,...t){return"line"===e?A(...t):"bar"===e?T(...t):"area"===e?C(...t):"pie"===e?W(...t):void 0}function A(e,t,a,i){e.beginPath();for(let n=0,s=t.length;n<s;n++){const{labelIndex:i,stackValue:l}=t[n],[s,o]=a.toPixels(i,l);e.lineTo(s,o)}e.save(),e.strokeStyle=i.color,e.lineWidth=i.lineWidth,e.globalAlpha=i.opacity,e.lineJoin="bevel",e.lineCap="butt",e.stroke(),e.restore()}function T(e,t,a,i){const{yMin:n}=a.getParams();e.save(),e.globalAlpha=i.opacity,e.fillStyle=i.color;for(let s=0,o=t.length;s<o;s++){const{labelIndex:l,stackValue:o,stackOffset:d=0}=t[s],[,r]=a.toPixels(l,xe(d,n)),[c,h]=a.toPixels(l,o),p=c-i.lineWidth/2,y=1===i.opacity?i.lineWidth+We:i.lineWidth;e.fillRect(p,h,y,r-h)}e.restore()}function I(e,t,a){const[i,n]=t.getCenter(),[l,s]=t.getSize(),[o]=t.toPixels(a.focusOn,0);e.fillStyle=a.color,e.fillRect(i-l/2,n-s/2,o-a.lineWidth/2+We,s),e.fillRect(o+a.lineWidth/2,n-s/2,l-(o+a.lineWidth/2),s)}function C(e,t,a,i){e.beginPath();for(let n=0,s=t.length;n<s;n++){const{labelIndex:i,stackValue:l}=t[n],[s,o]=a.toPixels(i,l);e.lineTo(s,o)}e.save(),e.fillStyle=i.color,e.lineWidth=i.lineWidth,e.globalAlpha=i.opacity,e.lineJoin="bevel",e.lineCap="butt",e.fill(),e.restore()}function W(e,t,a,i){const{visibleValue:n,stackValue:l,stackOffset:s=0}=t[0];if(!n)return;const{yMin:o,yMax:d}=a.getParams(),r=1/(d-o),c=n*r,h=2*(s*r*ye)-ye/2,p=2*(l*r*ye)-ye/2,{radius:g=120,center:[f,m],pointerVector:u}=i,y=u&&h<=u.angle&&u.angle<p&&u.distance<=g?Ce:0,x=(h+p)/2,v=Math.cos(x),b=Math.sin(x),M=v*y,S=b*y;e.save(),e.beginPath(),e.fillStyle=i.color,e.moveTo(f+M,m+S),e.arc(f+M,m+S,g,h,p),e.lineTo(f+M,m+S),e.fill(),e.font=`700 ${Q(c,g)}px Helvetica, Arial, sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle="white";const k=G(c,g);e.fillText(`${ue(100*c)}%`,f+v*k+M,m+b*k+S),e.restore()}function E(e){const t={};return["skin-day","skin-night"].forEach(a=>{t[a]={},Object.keys(Ke[a]).forEach(i=>{const n=N(Ke[a][i]);i.startsWith(`palette-${e}`)?t[a][i.replace(`palette-${e}-`,"")]=n:!i.startsWith(`palette-`)&&(t[a][i]=n)})}),t}function O(e,t,a){return H(e[Qe][t],a)}function N(e){const[t,a]=e.replace("#","").split("/");return[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16),a?parseFloat(a):1]}function H([e,t,i,n=1],a=1){return`rgba(${e}, ${t}, ${i}, ${n*a})`}function F(e,t){function a(a){l=a,"mousedown"===a.type?(te(document,"mousemove",n),te(document,"mouseup",i)):"touchstart"===a.type&&(te(document,"touchmove",n),te(document,"touchend",i),te(document,"touchcancel",i),a.pageX===void 0&&(a.pageX=a.touches[0].pageX)),t.draggingCursor&&document.body.classList.add(`cursor-${t.draggingCursor}`),t.onCapture&&t.onCapture(a),t.onLongPress&&(s=setTimeout(()=>t.onLongPress(),Le))}function i(a){l&&(s&&(clearTimeout(s),s=null),t.draggingCursor&&document.body.classList.remove(`cursor-${t.draggingCursor}`),ae(document,"mouseup",i),ae(document,"mousemove",n),ae(document,"touchcancel",i),ae(document,"touchend",i),ae(document,"touchmove",n),l=null,t.onRelease&&t.onRelease(a))}function n(a){l&&(s&&(clearTimeout(s),s=null),"touchmove"===a.type&&a.pageX===void 0&&(a.pageX=a.touches[0].pageX),t.onDrag&&t.onDrag(a,l,{dragOffsetX:a.pageX-l.pageX}))}let l=null,s=null;te(e,"mousedown",a),te(e,"touchstart",a)}function X(e){return e.map(e=>{const t=new Date(e),a=t.getDate(),i=Je[t.getMonth()];return{value:e,text:`${a} ${i}`}})}function D(e){return e.map(e=>{const t=new Date(e),a=t.getUTCHours(),i=t.getUTCMinutes();return{value:e,text:`${10>a?"0":""}${a}:${10>i?"0":""}${i}`}})}function Y(e,t=1){if(1e6<=e)return z(e/1e6,t)+"M";return 1e3<=e?z(e/1e3,t)+"K":e}function z(e,t){return e.toFixed(t).replace(/(\d{3,})\.\d+/,"$1").replace(/\.0+$/,"")}function R(e){return(e+"").replace(/\d(?=(\d{3})+$)/g,"$& ")}function B(e,t=!1){const{value:a}=e,i=new Date(a),n=t?$e:Ue;return`${n[i.getDay()]}, ${j(e,t)}`}function j(e,t=!1){const{value:a}=e,i=new Date(a),n=i.getDate(),l=t?Je:Ze,s=l[i.getMonth()];return`${n} ${s} ${i.getFullYear()}`}function q(e){return ge(2,e)}function Z(e){return ve(Math.log2(e||1))}function J(e){return Ge[e]||Ge[Ge.length-1]}function U(e){return Ge.findIndex(t=>t>=e)||Ge.length-1}function $(e,t,a){const i=fe(t+Pe,a-t);return 40>=i&&(e=fe(1,e,i/40)),e}function _(e,t){return t-Pe<=20?fe(1,e,(t-Pe)/20):e}function K(e){return fe(...e.getSize())*Ie}function Q(e,t){return(t+150*e)/8}function G(e,t){return .99<=e?0:fe(1-Math.log(30*e)/5,4/5)*t}function ee(e,t){return xe(0,fe(2*e[`opacity#${t}`]-1,1))}function te(e,t,a){e.addEventListener(t,a)}function ae(e,t,a){e.removeEventListener(t,a)}function ie(e,t,a="",i=!1){const n=e.parentNode;n.classList.add("lovely-chart--transition-container");const l=tt(e.tagName);l.className=`${a} lovely-chart--transition lovely-chart--position-${i?"top":"bottom"} lovely-chart--state-hidden`,l.innerHTML=t;const s=a.length?`.${a.split(" ").join(".")}`:"",o=n.querySelectorAll(`${s}.lovely-chart--state-hidden`);return o.forEach(t=>t.remove()),e.classList.add("lovely-chart--transition"),e.classList.remove("lovely-chart--position-bottom","lovely-chart--position-top"),e.classList.add(i?"lovely-chart--position-bottom":"lovely-chart--position-top"),n.insertBefore(l,e.nextSibling),ne(l),le(e),l}function ne(e){e.classList.remove("lovely-chart--state-animated"),e.classList.add("lovely-chart--state-animated"),e.classList.remove("lovely-chart--state-hidden")}function le(e){e.classList.remove("lovely-chart--state-animated"),e.classList.add("lovely-chart--state-animated"),e.classList.add("lovely-chart--state-hidden")}function se(e){const t=e.length;let a=e[0],n=e[0];for(let l=0;l<t;l++){const t=e[l];t>a?a=t:t<n&&(n=t)}return{max:a,min:n}}function oe(e){return[].concat.apply([],e)}function de(e){const t=[],a=e.length;for(let n=0,i=e[0].length;n<i;n++){t[n]=0;for(let i=0;i<a;i++)t[n]+=e[i][n]}return t}function re(e,t){return new Proxy({},{get:(a,i)=>void 0===t[i]?e[i]:t[i]})}function ce(e,t,a=!0,i=!0){let n,l,s=!1;return function(...o){n=o,l=!0,s||(a&&(l=!1,e(...n)),s=!0,setTimeout(()=>{s=!1,i&&l&&e(...n)},t))}}function he(e){let t,a=!1;return function(...i){t=i,a||(a=!0,requestAnimationFrame(()=>{a=!1,e(...t)}))}}function pe(e,t,a=!0,i=!0){let n=null;return function(){n?(clearTimeout(n),n=null):a&&e(),n=setTimeout(()=>{i&&e(),n=null},t)}}window.LovelyChart={create:function(t){function a(){w.update()}function i(){n(),C=r(V,t.title,S),l(),w=e(k,I,s),W=c(T,k,I,D),O=h(V,k,D,o),N=p(V,k,I,D,M,v),H=y(V,k,d),F=u(k,t,w,C,O,N,H)}function n(){V=tt(),V.className=`lovely-chart--container lovely-chart--palette-${t.palette||we}`,et(V);const e=document.getElementById(t.containerId);e.appendChild(V)}function l(){const{canvas:e,context:t}=g(V,{width:V.clientWidth,height:Ve});A=e,T=t,I={width:A.offsetWidth,height:A.offsetHeight}}function s(e){X=e;const{datasets:t}=k,a={from:e.labelFromIndex,to:e.labelToIndex},i={begin:e.begin,end:e.end,totalXWidth:e.totalXWidth,yMin:e.yMinViewport,yMax:e.yMaxViewport,availableWidth:I.width,availableHeight:I.height-Fe,xPadding:Pe,yPadding:Ae},n=t.map(({key:t})=>e[`opacity#${t}`]),l=b(k,t,a,n,i),s=L(i);let o=null,d=null;if(k.hasSecondYAxis){const i=t.find(e=>e.hasOwnYAxis),l={yMin:e.yMinViewportSecond,yMax:e.yMaxViewportSecond};o=b(k,[i],a,n,l)[0],d=s.copy(l)}C.setCaption(F.isZoomed()?B(k.xLabels[e.labelFromIndex]):`${j(k.xLabels[e.labelFromIndex+1])}`+" - "+`${j(k.xLabels[e.labelToIndex-1])}`),f(A,T),P(T,e,k,a,l,s,o,d,Te,n,D),k.isPie||(W.drawYAxis(e,s,d),W.drawXAxis(e,s)),O.update(e),N.update(e,l,s,o,d)}function o(e){w.update({range:e})}function d(e){w.update({filter:e})}function v(e){(k.isBars||k.isPie)&&w.update({focusOn:e})}function M(e){F.zoomIn(X,e)}function S(){F.zoomOut(X)}let k,w,V,A,T,I,C,W,O,N,H,F,X;const D=E(t.palette);return m(t).then(e=>{k=x(e,t.datasetColors),i()}),{redraw:a}},setupColors:function(e){Ke=e},changeSkin:function(e){Qe=e}};const be=window.devicePixelRatio||1,Me="x",Se={begin:.8,end:1},ke=300,we="type-1",Le=500,Pe=10,Ve=320,Ae=10,Te=2,Ie=.9/2,Ce=10,We=.5,Ee=20,Oe="300 10px Helvetica, Arial, sans-serif",Ne=45,He=40,Fe=30,Xe=1,De=.1,Ye=40,ze=1,Re=8,Be=ke,je=.1,qe=.5,Ze=["January","February","March","April","May","June","July","August","September","October","November","December"],Je=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Ue=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],$e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],_e=["begin 200 fast","end 200 fast","labelFromIndex 200 fast floor","labelToIndex 200 fast ceil","xAxisScale 400","yMinViewport","yMaxViewport","yMinViewportSecond","yMaxViewportSecond","yMinMinimap","yMaxMinimap","yMinMinimapSecond","yMaxMinimapSecond","yAxisScale","yAxisScaleSecond"];let Ke,Qe="skin-day";const Ge=[1,2,8,18,50,100,250,500,1e3,2500,5e3,1e4,25e3,5e4,1e5,25e4,5e5,1e6,25e5,5e6,1e7,25e6,5e7,1e8],et=(()=>{const e=[],t=pe(function(){e.forEach(e=>{e.classList.remove("lovely-chart--state-invisible")})},500,!0,!1),a=pe(function(){e.forEach(e=>{const{top:t,bottom:a}=e.getBoundingClientRect(),i=0>a||t>window.innerHeight;e.classList.toggle("lovely-chart--state-invisible",i)})},500,!1,!0);return function(i){e.push(i),1===e.length&&(window.onscroll=()=>{t(),a()})}})(),tt=(e="div")=>document.createElement(e)})();